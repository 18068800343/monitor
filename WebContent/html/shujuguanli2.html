<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<title>高速桥梁监测系统集成管理平台</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="shortcut icon" href="../font/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" media="screen" href="../style/bootstrap.min.css">
	<link rel="stylesheet" href="../font/iconfont.css">
	<link rel="stylesheet" href="../font2/iconfont.css">
	<link href="../style/style.css" rel="stylesheet">
	<link href="../style/style2.css" rel="stylesheet">
	<link href="../js/toastr/toastr.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../style/jquery.dataTables.min.css">
	<style>
		body{
			background: #fff;
		}
		.yihang{
			display:flex;
			align-items: center;
		}
	</style>
	
</head>

<body>

		<section>
			<!-- header -->
			<header class="header">
            <div>
                <p style="font-size:28px;margin: 0px;"><img src="../img/qiaoLogo.png" alt="" style="width:48px;height:50%;">&nbsp;高速桥梁监测系统集成管理平台</p>
            </div>
            <div style="display:flex;">
	                <div class="renyuan zhuashou"><a href="#"><img src="../img/登陆人.png" alt="">&nbsp;<span id="uname"></span></a></div>
	                <div style="padding-top:5px;">丨</div>
	                <div class="renyuan zhuashou"><a href="#" id="logOut"><img src="../img/退出.png" alt="">&nbsp;退出</a></div>
	        </div>
        </header>
        <div>
        	<div class="caidanlan">
        			<div class="box1 yihang3" id="boxa">
		                <p style="padding-top:10px;"><a href="./index.html" ><!-- <span class="glyphicon glyphicon-home" aria-hidden="true" style="color:#fff;font-size:16px;"></span> -->首页</a></p>
		            </div>
		            
		            <div class="btn-group" role="group">
					    <div class="dropdown-toggle box1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="boxb">
					     <p><!-- <i class="iconfont icon-qiaoliang" style="color:#fff;font-size:20px;"></i> -->桥梁信息</p>
					      
					    </div>
					    <ul class="dropdown-menu" id="qiaoSlect">
					      
					    </ul>
				  </div>
				  
				  <div class="btn-group" role="group">
					    <div class="dropdown-toggle box1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="boxc">
		                <p><!-- <i class="iconfont icon-jiancedianguanli"></i> -->测点管理</p>
					    </div>
					    <ul class="dropdown-menu" id="qiaoSlect2">
					      
					    </ul>
				  </div>
				  
				  <div class="btn-group" role="group">
					    <div class="dropdown-toggle box1active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="boxd">
		                <p><!-- <i class="iconfont icon-shujuguanli"></i> -->数据管理</p>
					    </div>
					    <ul class="dropdown-menu" id="qiaoSlect3">
					      
					    </ul>
				  </div>
				  
				  <div class="btn-group" role="group">
					    <div class="dropdown-toggle box1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="boxe">
		                <p><!-- <i class="iconfont icon-yujing" style="font-size:20px;"></i> -->分析预警</p>
					    </div>
					    <ul class="dropdown-menu" id="qiaoSlect4">
					      
					    </ul>
				  </div>
				   <div class="box1" id="boxf" >
		                <p><a href="./report.html"><!-- <i class="iconfont icon-book-thick" style="color:white;font-size:20px;"></i> -->监测报告</a></p>
		            </div>
		            <div class="box1" id="boxg" >
		                <p><a href="./cidian.html"><!-- <i class="iconfont icon-book-thick" style="color:white;font-size:20px;"></i> -->基础数据</a></p>
		            </div>
        	</div>
        </div>
			
			
		</section>

	<div>
		

		<div class="closeButton" >
				<div style="margin-left:45%;">
					<h2 id="brgName"></h2>
				</div>
		</div>

		<div>
			
			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
					
					<div style="background:#fff;">
						<div role="content">
							
							<div class="yihang">
										<!-- <div class="pull-left col-xs-1.5">
											<label>切换桥梁:</label>
										</div>
										<div class="pull-left col-xs-2">
												<select class="form-control" style="width:100%;" id="changeBrg">
												</select>
										</div> -->
										<div style="margin-left: 8px;">
												<div class="form-inline">
														<label>数据管理分类:</label>
														<select class="form-control"  id="m_type"  style="width:180px;;">
														</select>
												</div>
										</div>
										<div  class="yihang"  style="margin-left: 2%;">
												<div>
													<input type="text"  class="form-control" placeholder="请选择日期" id="reservation" onclick="" lay-key="1">
												</div>
												<span class="pull-left spa" style="margin-left: 5px;margin-right: 5px;">至</span>
												<div class="">
													<input type="text"  class="form-control" placeholder="请选择日期" id="reservationEnd" onclick="" lay-key="2">
												</div>
										</div>
										<div style="margin-left: 3%;">
												<div class="">
													<a class="btn btn-primary btn-sm"  onclick="searchFile()">检索</a>
												</div>
										</div>
										<div style="margin-left: 2%;">
												<div>
													<input class="form-control" id="searchData" value="" placeholder="搜索" type="text">
												</div>
										</div>
										
									</div>

								
							<div style="margin-top: 5px;">
								<table  class="table table-striped table-bordered table-hover" id="maincontent" >
									<thead>
										<tr role="row">
											<th>开始时间</th>
											<th>结束时间</th>
											<th>文件大小</th>
											<th>下载</th>
										</tr>
									</thead>

									<tbody>
									</tbody>
								</table>
							</div>

						</div>
					</div>
				</div>
			
			</div>
					
		</div>
		
	</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		  <h4 class="modal-title" id="myModalLabel">添加系统</h4>
		</div>
		<div class="modal-body">
			<table class="table table-bordered table-condensed">
				<tr>
					<td>管养单位</td>
					<td>
						<select class="form-control" style="width:180px;">
							<option>华通公司</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>所属路段</td>
					<td>
						<select class="form-control" style="width:180px;">
							<option>南京路12号</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>桥梁名称</td>
					<td>
						<select class="form-control" style="width:180px;">
							<option>金门大桥</option>
						</select>
					</td>
				</tr>
			</table>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
		  <button type="button" class="btn btn-primary">保存</button>
		</div>
	  </div>
	</div>
</div>

	<script src="../js/jquery.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<script src="../js/common-scripts.js"></script>
	<script src="../js/caidan.js"></script>
	<script src="../js/echarts.min.js"></script>
	<script src="../js/jquery.dataTables.min.js"></script>
	<script src="../js/laydate/laydate.js"></script>
	<script src="../js/toastr/toastr.min.js"></script>
    <script src="../js/myTool.js"></script>
	<script src="../js/login.js"></script>
	<!-- <script src="./js/main.js"></script> -->
	<script>
		var id;
	 	$(document).ready( function () {
	 		showUserName();
	 		var thisHref=location.href;
			id=thisHref.split("?")[1];
	 		laydate.render({
				  elem: '#reservation'//指定元素
			});
	 		laydate.render({
				  elem: '#reservationEnd'//指定元素
			});
	 		$("#m_type").trigger("change");
	    	initMenu();
	    	//getBrgName();
	    	initModeType();
		});
		
	 function getBrgName(){
		 $.ajax({
	            type: 'GET',
	            url: '../BrgCardServlet',
	            dataType: 'json',
	            data: {
	                type: "getBrgName",
	                id:id
	            },
	            error: function (msg) {
	                toastr.error("请求BrgCardServlet失败");
	            },
	            success: function (json) {
	            	$("#brgName").text('');
	            	$("#brgName").text(json.obj);
	            }
		 });
	 }	
	 
	 function initModeType(){
		 $.ajax({
	            type: 'GET',
	            url: '../BrgMonitorServlet',
	            dataType: 'json',
	            data: {
	                type: "initModeType",
	                id:id
	            },
	            error: function (msg) {
	                toastr.error("请求BrgMonitorServlet失败");
	            },
	            success: function (json) {
	            	var obj=json.obj;
	            	$("#m_type").html('');
	            	for(var i=0;i<obj.length;i++){
	            		$("#m_type").append("<option value="+obj[i]+">"+obj[i]+"</option>");
	            	}
	            	$("#m_type").trigger("change");
	            }
		 });
	 }

	
	$("#m_type").on("change",function(){
		selectFileList();
	})
	
	/* $("#changeBrg").on("change",function(){
		selectFileList();
	}) */
	
	function searchFile(){
		var startTime=$("#reservation").val();
        var endTime=$("#reservationEnd").val(); 
        if(startTime==''||endTime==''){
        	 toastr.error("存在未输入时间");
        	 return;
        }
        var start=new Date(startTime);
        var end=new Date(endTime);
        if(start.getTime()>=end.getTime()){
        	toastr.error("开始时间不可以大于等于结束时间");
       	 	return;
        }
		selectFileList();
	}
	
	function selectFileList(){
		myTool.mask.show('查询中...');
		$('#maincontent').dataTable({
			"deferRender": true,
	        "processing": true,
	        "bDestroy": true,
	        "iDisplayLength": 10,
	        "searching": true,
	        "lengthChange": false,
	        "sDom": 
				"t"+
				"<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
	        "oLanguage": {
			    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
			},
	        "bServerSide" : true,//服务器处理分页，默认是false，需要服务器处理，必须true 
	        "sAjaxDataProp" : "aData",//是服务器分页的标志，必须有  
	        "sAjaxSource" :"../BrgMonitorServlet?type=selectMonitorByTypeAndBrg&mType="+$('#m_type').val()+"&brgId="+id+"&startTime="+$('#reservation').val()+"&endTime="+$('#reservationEnd').val()+"",
			 "columns": [
			 			//{ "data": null}, 
			             { "data": "start_time"}, 
			             { "data": "end_time"},
			             { "data": "file_size"}, 
			             { "data": null}, 
			         ],
			         "columnDefs": [
			 						/* {	
			 								 "class": "tcenter",
			 								    "targets": 0,
			 								    "searchable": true,
			 								    "render": function(data, type, full) {
			 								  	  		return '<input type="checkbox" style="height:20px;width:20px;">'
			 								        }
			 								  } */
			 						{
		 								 "class": "tcenter",
		 								    "targets": 3,
		 								    "searchable": true,
		 								    "render": function(data, type, full) {
		 								    	var m_type=$("#m_type").val();
	 								    		if(full.is_download==1){
		 								    		  if(m_type=="动态称重"){
		 								    			 return "<a href='ftp://ht:ht123,@115.159.78.246/"+full.bridge_no+"W/"+full.data_file+"' download='"+full.data_file+"'><span class='glyphicon glyphicon-cloud-download' aria-hidden='true' title='下载'></span></a>";
		 								    		  }else if(m_type=="健康监测"){
		 								    			 return "<a href='ftp://ht:ht123,@115.159.78.246/"+full.bridge_no+"S/"+full.data_file+"' download='"+full.data_file+"'><span class='glyphicon glyphicon-cloud-download' aria-hidden='true' title='下载'></span></a>";
		 								    		  }else if(m_type=="风速风向"){
		 								    			 return "<a href='ftp://ht:ht123,@115.159.78.246/"+full.bridge_no+"F/"+full.data_file+"' download='"+full.data_file+"'><span class='glyphicon glyphicon-cloud-download' aria-hidden='true' title='下载'></span></a>";
		 								    		  }else if(m_type=="GPS"){
		 								    			 var textName=full.data_file;
		 								    			 var gNo=textName.substring(3,4);
		 								    			 var bNo=full.bridge_no+"_0"+gNo;
		 								    			return "<a href='ftp://ht:ht123,@115.159.78.246/"+bNo+"G/"+full.data_file+"' download='"+full.data_file+"'><span class='glyphicon glyphicon-cloud-download' aria-hidden='true' title='下载'></span></a>";
		 								    		  }
										    	  }else{
										    		  if(m_type=="动态称重"){
										    			  	return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+full.bridge_no+"W/"+full.data_file+"' download='"+full.data_file+"'><span class='glyphicon glyphicon-cloud-download' aria-hidden='true' title='下载'></span></a>";
			 								    		  }else if(m_type=="健康监测"){
			 								    			 return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+full.bridge_no+"S/"+full.data_file+"' download='"+full.data_file+"'><span class='glyphicon glyphicon-cloud-download' aria-hidden='true' title='下载'></span></a>";
			 								    		  }else if(m_type=="风速风向"){
			 								    			 return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+full.bridge_no+"F/"+full.data_file+"' download='"+full.data_file+"'><span class='glyphicon glyphicon-cloud-download' aria-hidden='true' title='下载'></span></a>";
			 								    		  }else if(m_type=="GPS"){
			 								    			 var textName=full.data_file;
			 								    			 var gNo=textName.substring(3,4);
			 								    			 var bNo=full.bridge_no+"_0"+gNo;
			 								    			 return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+bNo+"G/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
			 								    		  }
										    	  }
		 								        }
		 								  },{
				 								 "class": "tcenter",
				 								    "searchable": true,
				 								    "render": function(data, type, full) {
				 								  	  		return '';
				 								  }
				 						}
			 						],
	        "order": [[0, 'asc']],
	        "oLanguage": { //国际化配置
	        "sProcessing": "正在获取数据，请稍后...",
	        "sLengthMenu": "显示 _MENU_ 条",
	        "sZeroRecords": "查询不到相关数据",
	        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
	        "sInfoEmpty": "记录数为0",
	        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
	        "sInfoPostFix": "",
	        "sSearch": "搜索",
	        "sUrl": "",
	        "oPaginate": {
	            "sFirst": "第一页",
	            "sPrevious": "上一页",
	            "sNext": "下一页",
	            "sLast": "最后一页"
	        }},
	        
		});
		$('#maincontent').dataTable().fnClearTable();
		myTool.mask.hide();
	}
	
	$("#searchData").on("input", function(e){
		var d = $("#searchData").val();
		$("#maincontent").DataTable().search(d).draw(true);
	});
	
	/* function initTable(){
		myTool.mask.show('查询中...');
		$('#maincontent').dataTable({
			"deferRender": true,
	        "processing": true,
	        "bDestroy": true,
	        "iDisplayLength": 10,
	        "searching": true,
	        "lengthChange": false,
	        "oLanguage": {
			    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
			},
	        "bServerSide" : true,//服务器处理分页，默认是false，需要服务器处理，必须true 
	        "sAjaxDataProp" : "aData",//是服务器分页的标志，必须有  
	        "sAjaxSource" :"../BrgMonitorServlet?type=selectMonitorByTypeAndBrg&mType="+$('#m_type').val()+"&brgId="+id+"&startTime="+$('#reservation').val()+"&endTime="+$('#reservationEnd').val()+"",
			 "columns": [
			 			{ "data": null}, 
			             { "data": "start_time"}, 
			             { "data": "end_time"},
			             { "data": "file_size"}, 
			             { "data": null}, 
			         ],
			         "columnDefs": [
			 						{	
			 								 "class": "tcenter",
			 								    "targets": 0,
			 								    "searchable": true,
			 								    "render": function(data, type, full) {
			 								  	  		return '<input type="checkbox" style="height:20px;width:20px;">'
			 								        }
			 								  },{	
					 								 "class": "tcenter",
					 								    "targets": 4,
					 								    "searchable": true,
					 								    "render": function(data, type, full) {
					 								    		var m_type=$("#m_type").val();
					 								    		if(full.is_download==1){
						 								    		  if(m_type=="动态称重"){
						 								    			 return "<a href='ftp://ht:ht123,@115.159.78.246/"+full.bridge_no+"W/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
						 								    		  }else if(m_type=="健康监测"){
						 								    			 return "<a href='ftp://ht:ht123,@115.159.78.246/"+full.bridge_no+"S/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
						 								    		  }else if(m_type=="风速风向"){
						 								    			 return "<a href='ftp://ht:ht123,@115.159.78.246/"+full.bridge_no+"F/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
						 								    		  }else if(m_type=="GPS"){
						 								    			 var textName=full.data_file;
						 								    			 var gNo=textName.substring(3,4);
						 								    			 var bNo=full.bridge_no+"_0"+gNo;
						 								    			return "<a href='ftp://ht:ht123,@115.159.78.246/"+bNo+"G/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
						 								    		  }
														    	  }else{
														    		  if(m_type=="动态称重"){
														    			  	return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+full.bridge_no+"W/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
							 								    		  }else if(m_type=="健康监测"){
							 								    			 return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+full.bridge_no+"S/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
							 								    		  }else if(m_type=="风速风向"){
							 								    			 return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+full.bridge_no+"F/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
							 								    		  }else if(m_type=="GPS"){
							 								    			 var textName=full.data_file;
							 								    			 var gNo=textName.substring(3,4);
							 								    			 var bNo=full.bridge_no+"_0"+gNo;
							 								    			 return "<a id='"+full.data_file+"' href='ftp://ht:ht123,@115.159.109.101/"+bNo+"G/"+full.data_file+"' download='"+full.data_file+"'>下载</a>";
							 								    		  }
														    	  }
					 								        }
					 								  }
			 						],
	        "order": [[0, 'asc']],
	        "oLanguage": { //国际化配置
	        "sProcessing": "正在获取数据，请稍后...",
	        "sLengthMenu": "显示 _MENU_ 条",
	        "sZeroRecords": "查询不到相关数据",
	        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
	        "sInfoEmpty": "记录数为0",
	        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
	        "sInfoPostFix": "",
	        "sSearch": "搜索",
	        "sUrl": "",
	        "oPaginate": {
	            "sFirst": "第一页",
	            "sPrevious": "上一页",
	            "sNext": "下一页",
	            "sLast": "最后一页"
	        }},
	        
		});
		myTool.mask.hide();
    } */
	
	function initMenu(){
		$.ajax({
            type: 'GET',
            url: '../BrgCardServlet',
            dataType: 'json',
            data: {
                type: "selectAllBrg"
            },
            error: function (msg) {
                toastr.error("请求BrgCardServlet失败");
            },
            success: function (json) {
                if (json.success == "success") {
                	var arr = json.obj;
                	$("#qiaoSlect").html('')
                	$("#qiaoSlect2").html('')
                	$("#qiaoSlect3").html('')
                	$("#qiaoSlect4").html('')
                    for (var i = 0; i < arr.length; i++) {
                    	$("#qiaoSlect").append('<li><a href="./qiaoliangguanli.html?'+arr[i].bridge_id+'">'+arr[i].bridge_name+'</a></li>')
                    	$("#qiaoSlect2").append('<li><a href="./cedianguanli.html?'+arr[i].bridge_id+'">'+arr[i].bridge_name+'</a></li>')
                    	$("#qiaoSlect3").append('<li><a href="./shujuguanli.html?'+arr[i].bridge_id+'">'+arr[i].bridge_name+'</a></li>')
                    	$("#qiaoSlect4").append('<li><a href="./yujin.html?'+arr[i].bridge_id+'">'+arr[i].bridge_name+'</a></li>')
                        /* $("#changeBrg").append('<option value='+arr[i].bridge_id+'>'+arr[i].bridge_name+'</option>') */
                    }
                    /* $("#changeBrg").val(id); */
                }else {
                    toastr.error("初始桥梁出错");
                }
            }
        });
	}

	
	</script>
</body>

</html>